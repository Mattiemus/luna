mod function_application;
mod matcher;
mod permutations;
mod rule_dc;
mod rule_dnc;
mod rule_fve;
mod rule_fvea;
mod rule_fveac;
mod rule_ivea;
mod rule_iveac;
mod rule_svea;
mod rule_sveac;
mod rule_svec;
mod rule_svef;
mod rule_t;
mod rule_ve;
mod subsets;

use std::collections::HashMap;

use crate::Expr;
use crate::Symbol;

pub use matcher::Matcher;

pub type SolutionSet = HashMap<Symbol, Expr>;

#[derive(Clone, PartialEq, Debug)]
pub struct MatchEquation {
    pattern: Expr,
    ground: Expr,
}

#[derive(PartialEq, Debug)]
pub struct Substitution {
    variable: Symbol,
    ground: Expr,
}

pub trait MatchRule: Sized + MatchGenerator {
    /// Checks if this rule applies to the active match equation, constructing a generator if it
    /// does.
    fn try_rule(match_equation: &MatchEquation) -> Option<Self>;
}

pub type MatchResultList = Vec<MatchResult>;

#[derive(PartialEq, Debug)]
pub enum MatchResult {
    MatchEquation(MatchEquation),
    Substitution(Substitution),
}

/// A `MatchGenerator` iterates over every way it can transform a match equation and
/// every solution generated by that transformation.
pub trait MatchGenerator: Iterator<Item = MatchResultList> {
    /// Returns the match equation that this match generator was created to solve.
    fn match_equation(&self) -> MatchEquation;
}
